"use strict";angular.module("myApp",["ngRoute","ngAnimate","myApp.editor"]).config(["$routeProvider",function(e){e.otherwise({redirectTo:"/index"})}]),function(){function e(){var e=this;return e.editor="",e.result="",e}function t(e,t,n){var o=this;o.$storage=e,o.editStatus=!1,o.categorySelected=0,o.noteSelected=0,o.openModal=!1,o.category={},o.note={},o.categoryList=[],o.noteList=[],o.note={};var r={init:function(){this.initCategory(),o.categorySelected&&this.initNote(o.categorySelected)},initCategory:function(){o.categoryList=t.getCategoryList(),0!=o.categoryList.length&&(o.categorySelected=o.categoryList[0].id)},initNote:function(e){o.noteList=t.getNoteListById(e),0!=o.noteList.length&&(o.note=o.noteList[0],o.noteSelected=o.note.id)},resetNote:function(){o.note={}}};r.init(),o.edit=function(){o.editStatus=!0},o.save=function(){o.editStatus=!1,o.note.updateTime=n("date")(new Date,"yyyy-MM-dd HH:mm:ss"),t.updateNote(o.categorySelected,o.note)},o.selectCategory=function(e){o.categorySelected=e,r.initNote(e)},o.selectNote=function(e){o.noteSelected=e.id,o.note=e},o.open=function(e){o.type=e,o.openModal=!0},o.add=function(e){if("category"==e){var i={id:t.generateId(o.categoryList),name:o.name,noteList:[]};t.saveCategory(i),o.name="",o.openModal=!1,o.categorySelected=i.id,r.initNote(o.categorySelected)}else if("note"==e){var a={id:t.generateId(t.getNoteListById(o.categorySelected)),title:o.name,tag:[],createTime:n("date")(new Date,"yyyy-MM-dd HH:mm:ss"),updateTime:n("date")(new Date,"yyyy-MM-dd HH:mm:ss")};o.note=t.saveNote(o.categorySelected,a),o.name="",o.openModal=!1,o.noteSelected=a.id,o.noteList=t.getNoteListById(o.categorySelected)}},o.cancel=function(){o.openModal=!1},o.delCategory=function(e){t.deleteCategory(e),event.preventDefault()},o.delNote=function(e){t.deleteNote(o.categorySelected,e),r.resetNote(),event.preventDefault()},o.addTag=function(){angular.isUndefined(o.tag)||(o.note.tag.push(o.tag),o.tag="",t.updateNote(o.categorySelected,o.note))},o.delTag=function(e){t.delTag(o.categorySelected,o.noteSelected,e)}}t.$inject=["$localStorage","NoteService","$filter"],angular.module("myApp.editor",["ngRoute","hljs","editor.filter","ngStorage","editor.service","editor.directive"]).config(["$routeProvider",function(e){e.when("/editor",{templateUrl:"views/editor.html",controller:"EditorController"}).when("/index",{templateUrl:"views/index.html",controller:"IndexController"})}]).controller("EditorController",e).controller("IndexController",t)}(),angular.module("editor.directive",[]).directive("fullScreen",function(){return{restrict:"A",scope:!0,link:function(e,t,n){var o=n.categorytarget,r=n.notetarget,i=n.editortarget,a={fullScreen:function(e,t,n){$("#"+e).addClass("category-menu-move"),$("#"+t).addClass("note-menu-move"),$("#"+n).addClass("editor-move")},exitFullScreen:function(e,t,n){$("#"+e).removeClass("category-menu-move"),$("#"+t).removeClass("note-menu-move"),$("#"+n).removeClass("editor-move")}};e.fullScreenText="全屏编辑",e.fullScreenFlag=!1,e.toggleFullScreen=function(){e.fullScreenFlag?(e.fullScreenText="全屏编辑",a.exitFullScreen(o,r,i)):(e.fullScreenText="退出全屏",a.fullScreen(o,r,i)),e.fullScreenFlag=!e.fullScreenFlag}}}}),function(){"uss strict";angular.module("editor.filter",[]).filter("render",["$sce",function(e){return function(t){return angular.isUndefined(t)||0!=t.length&&(t=marked(t)),e.trustAsHtml(t)}}])}(),function(){function e(e){function t(e,t){var n=-1;return e.forEach(function(e,o){e.id==t&&(n=o)}),n}function n(e){return console.log(e),0==e.length?1:e[e.length-1].id+1}function o(){return e.categoryList||(e.categoryList=[]),e.categoryList}function r(n){var r=t(o(),n);return e.categoryList[r].noteList}function i(e,t){var n=r(e).filter(function(e){return e.id==t});return 0==n.length?null:n[0]}function a(t){e.categoryList.push(t)}function c(t){t.id&&(e.categoryList[t.id-1]=t)}function l(n,r){var i=t(o(),n);return-1!=i&&e.categoryList[i].noteList.push(r),r}function d(n,i){var a=t(o(),n),c=r(n);if(i.id){var l=t(c,i.id);c[l]=i,e.categoryList[a].noteList=c}}function u(n){var r=t(o(),n);e.categoryList.splice(r,1)}function g(n,i){var a=t(o(),n),c=t(r(n),i);e.categoryList[a].noteList.splice(c,1)}function s(n,i,a){var c=t(o(),n),l=t(r(n),i);e.categoryList[c].noteList[l].tag=e.categoryList[c].noteList[l].tag.filter(function(e){return e!=a})}return{generateId:n,getCategoryList:o,getNoteListById:r,getNoteById:i,saveCategory:a,updateCategory:c,saveNote:l,updateNote:d,deleteCategory:u,deleteNote:g,delTag:s}}e.$inject=["$localStorage"],angular.module("editor.service",[]).factory("NoteService",e)}();